# 開発ロードマップ

## プロジェクト目標

**最終目標**: 大学生10名規模での2-3km範囲リアル鬼ごっこ運営支援PWA

**MVP目標日**: 未定（Supabase設定次第）
**β版目標日**: 未定

## Phase 1: 基礎実装 ✅ (完了)

**期間**: 2025-08-06  
**状況**: 完了

### 完了した機能

- Next.js + Supabase基盤構築
- 認証・位置情報・地図システム
- 役職別UI（逃走者・鬼・GM）
- PWA基礎設定

### 成果物

- 20個のソースファイル
- 完全なTypeScript型システム
- 3つの役職別画面

---

## Phase 2: 実用化準備 🚧 (次回優先)

**想定期間**: 1-2セッション  
**目標**: 実際にテストプレイ可能な状態

### 2.1 Supabase実環境構築

- [ ] Supabaseプロジェクト作成・設定
- [ ] Authentication有効化
- [ ] Database設定・Row Level Security (RLS)
- [ ] 実環境での動作確認

### 2.2 モバイル対応最適化

- [ ] レスポンシブデザイン調整
- [ ] タッチ操作最適化
- [ ] PWAインストールテスト
- [ ] バッテリー使用量確認

### 2.3 基本的なゲーム機能

- [ ] ゲーム開始/終了制御
- [ ] 制限時間表示
- [ ] 基本的な勝利条件判定

**重要マイルストーン**: 初回実機テストプレイ実施

---

## Phase 3: 通知・ミッション機能 ✅ (ほぼ完了)

**想定期間**: 2-3セッション
**状況**: Phase 3.1, 3.2完了、3.3一部完了

### 3.1 Push通知システム ✅ (完了)

- [x] Web Push API設定
- [x] 通知許可フロー
- [x] 役職別通知ロジック
  - [x] ゲーム開始/終了通知（テンプレート実装済み）
  - [x] ミッション完了通知（テンプレート実装済み）
  - [x] 捕獲/救出通知（テンプレート実装済み）
- [x] VAPIDキー生成・管理
- [x] プッシュサブスクリプションAPI（subscribe/unsubscribe/send）
- [x] プッシュ通知サーバー統合
- [ ] バックグラウンド通知テスト（実機）
- [ ] ゲームイベント連動の自動通知

### 3.2 ミッションシステム ✅ (完了)

- [x] ミッションデータモデル実装
- [x] 位置ベース判定ロジック
  - [x] エリア到達判定（Haversine距離）
  - [x] 滞在時間計測
  - [x] 距離計算最適化
- [x] ミッション進行UI
- [x] 達成状況リアルタイム同期

### 3.3 ゲーム進行管理 🚧 (一部完了)

- [x] GM用ミッション作成UI
- [x] 動的ミッション配信
- [x] 進行状況ダッシュボード
- [ ] 自動通知トリガー（ゲームイベント連動）

---

## Phase 4: エリア管理・安全機能 🚧 (一部完了)

**想定期間**: 2-3セッション
**状況**: Phase 4.1完了、4.3一部完了

### 4.1 エリア管理システム ✅ (完了)

- [x] セーフゾーン設定UI
- [x] 立禁エリア設定UI
- [x] ドラッグ&ドロップでのエリア編集
- [ ] エリア境界での自動警告

### 4.2 安全機能強化 📋

- [ ] 危険エリア警告システム
- [ ] 緊急停止機能
- [ ] 参加者の安全状況監視
- [ ] SOS機能

### 4.3 位置情報精度調整 🚧 (一部完了)

- [x] GM用精度設定UI
- [x] 更新間隔動的調整
- [ ] 通信断時の挙動改善

---

## Phase 5: 高度なゲーム機能 🎮

**想定期間**: 3-4セッション

### 5.1 特殊役職システム

- [ ] データモデル拡張
- [ ] 特殊能力定義・実装
- [ ] バランス調整機能

### 5.2 チーム戦機能

- [ ] チーム間通信
- [ ] チーム別スコアリング
- [ ] 連携ミッション

### 5.3 ゲームモード追加

- [ ] 複数ゲームモード選択
- [ ] カスタムルール設定
- [ ] トーナメント機能

---

## Phase 6: 分析・改善機能 🚧 (一部完了)

**想定期間**: 2-3セッション
**状況**: Phase 6.1, 6.2完了

### 6.1 リプレイシステム ✅ (完了)

- [x] 移動履歴可視化
- [x] タイムライン再生
- [x] 可変速度再生（1x/2x/4x/8x）
- [x] シーク機能
- [ ] ハイライト機能

### 6.2 ゲーム分析 ✅ (完了)

- [x] 統計データ収集（位置履歴・速度・方向）
- [x] プレイヤー行動分析（移動距離・平均速度・最高速度）
- [x] ゲーム統計UI
- [ ] ゲームバランス分析

### 6.3 改善サイクル 📋

- [ ] フィードバック収集システム
- [ ] A/Bテスト基盤
- [ ] パフォーマンス監視

---

## Phase 7: 本格運用準備 🚀

**想定期間**: 2-3セッション

### 7.1 ドメイン・インフラ

- [ ] atok.dev ドメイン設定
- [ ] Cloudflare Pages設定
- [ ] 本番環境構築

### 7.2 運用機能

- [ ] 複数GM対応
- [ ] イベント管理システム
- [ ] 参加者募集機能

### 7.3 スケーラビリティ

- [ ] 大規模対応（50-100名）
- [ ] WebSocket高頻度同期
- [ ] 負荷テスト・最適化

---

## 技術的マイルストーン

### セキュリティ

- [ ] Supabase Row Level Security (RLS) 強化
- [ ] 位置情報保護対策
- [ ] 個人情報取扱改善

### パフォーマンス

- [ ] バンドルサイズ最適化
- [ ] 地図描画パフォーマンス
- [ ] バッテリー消費最適化

### 品質保証

- [ ] 自動テスト導入
- [ ] E2Eテスト設定
- [ ] CI/CD構築

## リスク管理

### 技術リスク

- **Supabase制限**: 無料枠・API制限対策
- **位置精度**: GPS精度の天候・環境依存
- **バッテリー**: 長時間使用での電池消耗

### 運用リスク

- **安全面**: 屋外活動での事故リスク
- **通信**: 電波状況による機能制限
- **参加者**: ルール理解・操作習熟

### 対策

- 段階的テスト実施
- フォールバック機能準備
- 十分な事前説明・練習時間確保

## 次回セッション重点項目

1. **Supabase実環境構築** (最高優先・ブロッカー)
   - 全マイグレーションの実行（push_subscriptions含む）
   - RLSポリシー設定
   - VAPIDキー生成と環境変数設定
2. **モバイル実機テスト**
   - プッシュ通知の実機動作確認
   - 位置履歴記録の精度検証
   - ゲーム全体フローのテスト
3. **自動通知トリガーの実装**
   - ゲーム開始/終了時の全員通知
   - ミッション完了時の通知
   - 捕獲時の通知

**目標**: 実際に屋外でテストプレイが可能な状態を目指す（全機能実装済み）
