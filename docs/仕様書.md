# 🏃 リアル鬼ごっこサポートアプリ 仕様書（Draft Ver.1.3）

## 1. 概要

大学生グループ（参加者 < 10 名）向けの大規模リアル鬼ごっこイベントを支援する PWA。

**想定エリア規模**

- 羽田空港第3ターミナル〜京急蒲田駅程度（約2-3km範囲）
- 将来的にさらなる大規模化を想定

**主要目標**

- 位置情報・通知を利用し、運営 1 名でも大規模エリアでのゲーム進行・トラブルリカバリが行えるようにする
- ゲームバランスと安全性を両立し、面白さを維持する
- 将来的な役職追加やドメイン変更（例: **atok.dev**）を容易にする拡張性を確保

---

## 2. スケール & 前提

| 区分                   | 人数  | 想定端末              | 備考                                      |
| ---------------------- | ----- | --------------------- | ----------------------------------------- |
| プレイヤー             | 4〜10 | iOS / Android スマホ  | PWA インストール必須 + バッテリー持参推奨 |
| 運営（ゲームマスター） | 1     | タブレット or PC 推奨 | 管理 UI・緊急操作対応 + LTE/5G必須        |

---

## 3. 主要機能

### 3.1 ユーザー管理

- QR / リンク招待で登録（ニックネーム + チーム + 役職）
- 運営 UI でプレイヤー強制配置・ステータス変更

### 3.2 位置情報トラッキング

| 要素     | 仕様                                                                                                      |
| -------- | --------------------------------------------------------------------------------------------------------- |
| 表示精度 | **調整可能**（ゲームバランスと技術的制約で決定：±10-50m）                                                 |
| 更新方式 | 定期バッチ公開：**15分〜60分間隔**を運営 UI で調節（バランス調整用）                                      |
| 非常時   | 通信断時は最後の座標をグレー表示し、再接続で補正。オフライン時はローカルストレージに一時保存（最大3時間） |

### 3.3 ゲーム進行

- **共通ミッション**をデフォルト（後日個別化対応可能なデータモデル）
- ミッション達成判定は自動（位置条件 + タイマー）。判定困難な場合のみ運営が手動確定
- 制限時間・セーフゾーン・立禁エリアを管理 UI でオンザフライ変更

### 3.4 通知・UX

| シーン              | 手段             | 目的                   |
| ------------------- | ---------------- | ---------------------- |
| ミッション開始/完了 | Push + バイブ    | 画面を見ずに把握       |
| 残り時間警告        | Push（音控えめ） | 歩きスマホ防止         |
| 安全喚起            | 繰り返しバイブ   | 立ち止まって確認を促す |

> **安全設計指針**
>
> - UI は「静止して見る」前提で大型ボタン + 明瞭カラー
> - ボタン押下時はアニメーション & 触覚フィードバック

### 3.5 ログ & リプレイ

- Supabase (PostgreSQL) に移動履歴・ミッション履歴を時系列保存
- 位置履歴を簡易再生（Leaflet Polyline）

---

## 4. システム構成

| レイヤ       | 技術                                               | 補足                                     |
| ------------ | -------------------------------------------------- | ---------------------------------------- |
| フロント     | Next.js + React (PWA)                              | Leaflet.js で地図 / Workbox でオフライン |
| バックエンド | Supabase (PostgreSQL + PostGIS + Auth)             | Database Functions で判定ロジック        |
| 通知         | Web Push API + Service Worker                      | ブラウザネイティブ Push 通知             |
| インフラ     | Vercel / Cloudflare Pages                          | 将来 **atok.dev** に CNAME 可能          |
| ドメイン     | MVP は臨時サブドメイン（例: `tag-app.vercel.app`） | 本番移行時に atok.dev へ                 |

---

## 5. 役職別 UI（初期）

| 役職           | 画面要素                                   | 特徴                             |
| -------------- | ------------------------------------------ | -------------------------------- |
| 逃走者         | 自位置 & 味方位置 / 共通ミッション         | 鬼は表示されない                 |
| 鬼             | 自位置 & 捕獲数 / レーダー表示             | 一定距離内の逃走者をアイコン表示 |
| ゲームマスター | 全員位置 / 制限エリア編集 / 手動操作パネル | 緊急リカバリ・設定変更可         |
| 特殊役職       | **未実装（データモデルのみ用意）**         |                                  |

---

## 6. 管理 UI（ゲームマスター）

- **ダッシュボード**：残時間・捕獲数・達成状況
- **マップエディタ**：ドラッグでエリア変更・追加
- **プレイヤー管理**：ステータス強制変更／再配置
- **システム設定**：位置公開間隔 (`X–Y` 秒)・通知一括送信
- **トラブルシュート**：位置リセット・キャッシュクリアボタン

---

## 7. ミッション例（MVP）

| ミッション | 達成条件               | 自動判定             | 備考                   |
| ---------- | ---------------------- | -------------------- | ---------------------- |
| エリア到達 | 指定エリア滞在 `T` 秒  | ○                    | タイマー完了で達成     |
| 逃走成功   | 制限時間内にゴール到達 | ○                    | ゴール地点到達時に終了 |
| 救出       | 捕獲地点タップで解放   | △（位置+手動タップ） | 近距離＆ボタン押下     |

---

## 8. デザイン方針

1. **シンプル & 直感的**：3 タップ以内で主要操作完結
2. **高コントラスト**：屋外でも視認可能な配色
3. **触覚・視覚フィードバック**：ボタン押下時に色変化 + バイブ
4. **拡張性**：コンポーネント設計を Atomic Design 準拠で分割

---

## 9. 今後の拡張計画（概要）

| フェーズ | 追加要素                                      | 優先度 |
| -------- | --------------------------------------------- | ------ |
| β        | 特殊役職（探知・支援など）・個別ミッション    | ★★★    |
| v1       | atok.dev ドメイン移行・データ永続化オプション | ★★     |
| v2       | マルチゲームマスター / WebSocket 高頻度同期   | ★      |
